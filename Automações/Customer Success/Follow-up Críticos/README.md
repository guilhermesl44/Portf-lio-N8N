# üö® Follow-up Autom√°tico de Clientes Cr√≠ticos

> **Categoria:** Customer Success | **Complexidade:** ‚≠ê‚≠ê | **Status:** ‚úÖ Em Produ√ß√£o

## üìù Vis√£o Geral

Criei este workflow para a equipe de projetos fazer acompanhamento proativo de clientes em situa√ß√£o cr√≠tica durante a implanta√ß√£o do sistema. Quando um cliente √© classificado como "CR√çTICO" pela equipe (baseado no andamento dos treinamentos e uso da plataforma), este workflow detecta automaticamente e envia uma mensagem personalizada via WhatsApp para tentar recuperar e apoiar o cliente.

O diferencial √© que usa IA (GPT-4o-mini) para criar mensagens √∫nicas e contextualizadas para cada cliente, mantendo um tom profissional e oferecendo suporte espec√≠fico.

## üéØ Por Que Criei Esta Automa√ß√£o

**O problema:**
- Clientes em dificuldade na implanta√ß√£o podem desistir do sistema
- Equipe de projetos n√£o consegue acompanhar manualmente todos
- Follow-up manual consome muito tempo
- Dif√≠cil manter consist√™ncia no acompanhamento
- Clientes cr√≠ticos podem passar despercebidos

**A solu√ß√£o:**
Um sistema que:
- Roda semanalmente (toda segunda-feira 09:30)
- Busca clientes com status "CR√çTICO" na API
- Gera mensagem personalizada com IA para cada um
- Envia via WhatsApp automaticamente
- Notifica equipe de projetos quando conclu√≠do

## üèóÔ∏è Como Funciona

### Fluxo do Processo

```
1. Schedule Trigger (Segunda-feira 09:30 - Semanal)
   ‚Üì
2. Busca lista de clientes na API do sistema
   ‚Üì
3. Filtra apenas clientes "HABILITADO"
   ‚Üì
4. Loop por cada cliente:
   ‚îú‚îÄ Verifica se Status = "CR√çTICO"
   ‚îú‚îÄ Se n√£o for cr√≠tico: pula
   ‚îî‚îÄ Se for cr√≠tico: processa
   ‚Üì
5. Para cliente cr√≠tico:
   ‚îú‚îÄ IA gera mensagem personalizada
   ‚îú‚îÄ Quebra mensagem em partes (3 campos)
   ‚îú‚îÄ Loop por cada parte da mensagem
   ‚îú‚îÄ Envia parte 1 via WhatsApp
   ‚îú‚îÄ Aguarda 15 segundos
   ‚îú‚îÄ Envia parte 2 via WhatsApp
   ‚îú‚îÄ Aguarda 15 segundos
   ‚îú‚îÄ Envia parte 3 via WhatsApp
   ‚îî‚îÄ Volta para pr√≥ximo cliente
   ‚Üì
6. Ao finalizar todos:
   ‚îî‚îÄ Notifica Let√≠cia (gestora) de sucesso
```

### Diagrama Visual

![Fluxo de Follow-up](./Imagens/Criticos.jpg) 

*Nota: Por quest√µes de confidencialidade, o arquivo JSON n√£o est√° dispon√≠vel publicamente.*

## ‚öôÔ∏è Componentes e Integra√ß√µes

### Tecnologias Utilizadas:
- **N8N:** Plataforma de automa√ß√£o
- **API interna:** Sistema de gest√£o de clientes
- **OpenAI GPT-4o-mini:** Gera√ß√£o de mensagens contextualizadas
- **Evolution API:** Envio via WhatsApp
- **Schedule:** Execu√ß√£o semanal

### Nodes do Workflow:
- **Schedule Trigger:** Executa segunda 09:30
- **HTTP Request1:** Busca clientes da API
- **Filter:** Filtra apenas habilitados
- **Loop Over Items1:** Loop por clientes
- **Edit Fields:** Organiza dados
- **IF:** Verifica se √© cr√≠tico
- **AI Agent:** Gera mensagem com IA
- **OpenAI Chat Model:** Modelo de linguagem
- **Structured Output Parser:** Formata sa√≠da
- **Split Out:** Quebra mensagem em partes
- **Loop 1:** Loop pelas partes da mensagem
- **Wait1:** Delay de 15 seg entre mensagens
- **Evolution API:** Envia WhatsApp
- **Wait:** Delay entre clientes
- **Aggregate:** Agrupa resultados finais
- **Evolution API1:** Notifica gestora

## üîß Funcionalidades Principais

### 1. Busca de Clientes na API Interna

Integra√ß√£o com sistema pr√≥prio de gest√£o:

**Endpoint:**
```
GET http://[SEU_SISTEMA]/api/IntegracaoClientes/GetClientes
?chave=[SUA_CHAVE_API]
```

**Retorna:**
```json
[
  {
    "Nome": "Loja Exemplo",
    "contato": "5511999998888",
    "Status": "CR√çTICO",
    "ResponsavelLoja": "Jo√£o Silva",
    "Habilitado": "HABILITADO"
  },
  // ... mais clientes
]
```

**Campos importantes:**
- **Nome:** Nome da empresa cliente
- **contato:** WhatsApp no formato internacional
- **Status:** CR√çTICO, OK, EM ANDAMENTO, etc
- **ResponsavelLoja:** Nome do respons√°vel/decisor
- **Habilitado:** Se cliente est√° ativo no sistema

### 2. Filtro Duplo de Clientes

Apenas clientes ativos E cr√≠ticos s√£o processados:

**Filtro 1 - Habilitados:**
```javascript
Filter Node:
IF (Habilitado === "HABILITADO") ‚Üí Passa
ELSE ‚Üí Ignora
```

**Filtro 2 - Cr√≠ticos:**
```javascript
IF Node:
IF (Status === "CR√çTICO") ‚Üí Processa com IA
ELSE ‚Üí Pula para pr√≥ximo
```

**Por que dois filtros?**
- Efici√™ncia: n√£o processa clientes inativos
- Foco: s√≥ gasta recursos com cr√≠ticos
- Economia de cr√©ditos de IA e WhatsApp

### 3. Gera√ß√£o Inteligente de Mensagens com IA

O agente de IA cria mensagens √∫nicas para cada cliente:

**Input para a IA:**
```javascript
{
  texto: `Nome do cliente: ${NomedoCliente}
          Para contexto a data de hoje √© ${$now}`,
  
  systemMessage: `Voc√™ √© um agente de IA que envia mensagens 
  aos clientes que est√£o com status CRITICO toda segunda-feira 
  de manh√£, perguntando como est√° o andamento do processo de 
  implanta√ß√£o e se precisam de aux√≠lio. Seja formal e profissional.`
}
```

**Structured Output Parser:**
```json
{
  "Boadia": "Boa tarde (cliente). Tudo bem? Esperamos que sim",
  "Motivodocontato": "Gostar√≠amos de acompanhar o progresso...",
  "Estamosadisposicao": "Permanecemos √† disposi√ß√£o para..."
}
```

**Por que 3 campos separados?**
- Simula conversa humana
- Mensagens chegam em sequ√™ncia
- Mais natural que texto grande √∫nico
- Aumenta engajamento

### 4. Envio Sequencial com Delays Humanizados

Mensagens s√£o enviadas como "digitando":

**Sequ√™ncia:**
```
1. Envia "Boadia"
   ‚Üì
2. Wait 15 segundos (simula digita√ß√£o)
   ‚Üì
3. Envia "Motivodocontato"
   ‚Üì
4. Wait 15 segundos
   ‚Üì
5. Envia "Estamosadisposicao"
   ‚Üì
6. Pr√≥ximo cliente
```

**C√≥digo do delay:**
```javascript
Wait1 Node:
amount: 15 segundos
```

**Por que 15 segundos?**
- Tempo realista de digita√ß√£o
- N√£o parece bot
- Cliente tem tempo de ler primeira mensagem
- Mais humano e natural

### 5. Loop Controlado com Reset

Processa cada cliente individualmente:

**Loop Over Items1:**
```javascript
// Loop principal de clientes
batchSize: 1  // Um cliente por vez
```

**Loop 1:**
```javascript
// Loop das 3 partes da mensagem
batchSize: 1  // Uma mensagem por vez
reset: {{ $('Loop 1').context.done }}  // Reseta ao terminar
```

**Fluxo:**
```
Cliente 1:
  Msg1 ‚Üí Wait 15s ‚Üí Msg2 ‚Üí Wait 15s ‚Üí Msg3
    ‚Üì
Cliente 2:
  Msg1 ‚Üí Wait 15s ‚Üí Msg2 ‚Üí Wait 15s ‚Üí Msg3
    ‚Üì
...
```

### 6. Notifica√ß√£o de Conclus√£o

Ao terminar, avisa a gestora de projetos:

**Evolution API1:**
```javascript
{
  instanceName: "Suporte",
  remoteJid: "[WHATSAPP_GESTOR]",
  messageText: `Bom dia!
O Follow-up com os clientes cr√≠ticos foi realizado com sucesso!`
}
```

**Aggregate antes da notifica√ß√£o:**
- Coleta todos os outputs processados
- Garante que tudo foi conclu√≠do
- Envia notifica√ß√£o √∫nica no final

## üéØ Exemplo de Mensagem Gerada

**Para cliente "Jo√£o Silva" da "Loja M√≥veis Premium":**

```
[Mensagem 1 - 09:35]
Boa tarde, Jo√£o! Tudo bem? Esperamos que sim.

[Aguarda 15 segundos]

[Mensagem 2 - 09:35]
Gostar√≠amos de acompanhar o progresso em rela√ß√£o ao processo 
de implanta√ß√£o at√© o momento e verificar se h√° alguma d√∫vida 
ou necessidade de suporte.

[Aguarda 15 segundos]

[Mensagem 3 - 09:35]
Permanecemos √† disposi√ß√£o para quaisquer esclarecimentos 
que se fizerem necess√°rios.
```

**Caracter√≠sticas:**
- Tom formal mas amig√°vel
- Contextualizada (menciona nome)
- Oferece suporte espec√≠fico
- N√£o parece autom√°tica
- Abre conversa para resposta

## üí° Estrat√©gia de Customer Success

### Por que Segunda-feira 09:30?
- In√≠cio da semana
- Momento produtivo
- Cliente mais receptivo
- Equipe dispon√≠vel para follow-up manual
- Tempo para responder durante a semana

### Por que Semanal?
- Frequ√™ncia adequada (n√£o incomoda)
- Tempo para cliente agir
- Permite acompanhar evolu√ß√£o
- Evita spam

### Status "CR√çTICO" - O que significa?
Baseado em crit√©rios da equipe de projetos:
- N√£o concluiu treinamentos
- Baixo uso do sistema
- Muitas d√∫vidas/tickets
- Risco de churn
- N√£o est√° progredindo na implanta√ß√£o

## üõ°Ô∏è Tratamento de Erros

### Evolution API com Continue on Error:
```javascript
onError: "continueErrorOutput"
```

**Se falhar envio:**
- N√£o trava workflow
- Continua para pr√≥ximo cliente
- Registra erro no log
- Gestora ainda recebe notifica√ß√£o final

### Aggregate garante conclus√£o:
- Aguarda todos os clientes processarem
- S√≥ notifica quando realmente terminou
- N√£o envia notifica√ß√£o parcial

## üéì Conceitos T√©cnicos Aplicados

### AI-Powered Personalization:
- Cada mensagem √© √∫nica
- IA adapta tom ao contexto
- N√£o usa templates fixos
- Personaliza√ß√£o em escala

### Multi-Stage Communication:
- Quebra mensagem em partes
- Delays entre partes
- Simula digita√ß√£o humana
- Aumenta taxa de leitura

### Batch Processing with Reset:
- Loop externo (clientes)
- Loop interno (mensagens)
- Reset ao terminar cada cliente
- Processamento controlado

### Status-Based Automation:
- Filtros baseados em status
- A√ß√£o diferente por situa√ß√£o
- Automa√ß√£o condicional

## üíª Configura√ß√£o Necess√°ria

### API Interna:

```javascript
{
  url: "http://[SEU_SISTEMA]/api/Integracao/GetClientes",
  chave: "SUA_CHAVE_API"
}
```

**Campos obrigat√≥rios no retorno:**
- Nome
- contato (WhatsApp)
- Status
- ResponsavelLoja
- Habilitado

### OpenAI:

```javascript
{
  model: "gpt-4o-mini",
  credenciais: "SUA_API_KEY"
}
```

### Evolution API:

```javascript
{
  instanceName: "Suporte",
  credenciais: "SUAS_CREDENCIAIS"
}
```

**WhatsApp da Gestora:**
- Configurar n√∫mero para notifica√ß√£o
- Node "Evolution API1"

## üöÄ Como Usar

### Setup Inicial:

1. **Configure API interna** com chave v√°lida
2. **Configure OpenAI** com API key
3. **Configure Evolution API** (WhatsApp)
4. **Ajuste n√∫mero da gestora** para notifica√ß√µes
5. **Customize system prompt** da IA se necess√°rio
6. **Teste manualmente** antes de ativar

### Personaliza√ß√£o do Prompt:

Para mudar tom ou conte√∫do das mensagens:

```javascript
// Node "AI Agent" ‚Üí options ‚Üí systemMessage

systemMessage: `Voc√™ √© um agente de IA que envia mensagens 
aos clientes que est√£o com status CRITICO toda segunda-feira 
de manh√£...

[AJUSTE O TOM E CONTE√öDO AQUI]
`
```

### Ajuste de Frequ√™ncia:

Para mudar o schedule:

```javascript
// Node "Schedule Trigger"

// Semanal nas segundas 09:30 (atual)
interval: daysInterval: 7

// Para di√°rio:
interval: daysInterval: 1

// Para quinzenal:
interval: daysInterval: 14
```

## üìä M√©tricas Sugeridas para Acompanhar

### Efetividade do Follow-up:
- Taxa de resposta dos clientes cr√≠ticos
- Tempo m√©dio at√© resposta
- % de clientes que saem de "CR√çTICO"
- Taxa de convers√£o para "OK"

### Operacional:
- N√∫mero de cr√≠ticos por semana
- M√©dia de mensagens enviadas
- Taxa de erro no envio
- Tempo de execu√ß√£o total

## ‚ö†Ô∏è Boas Pr√°ticas

### Follow-up Manual Necess√°rio:
- Automa√ß√£o √© o primeiro contato
- Equipe deve acompanhar respostas
- Cliente cr√≠tico precisa aten√ß√£o humana
- Automa√ß√£o + pessoal = melhor resultado

### Monitoramento:
- Verifique logs semanalmente
- Confirme que gestora recebeu notifica√ß√£o
- Revise mensagens geradas pela IA
- Ajuste prompt se necess√°rio

### Evitar Spam:
- Uma vez por semana √© adequado
- N√£o aumentar frequ√™ncia
- Se cliente responder, parar automa√ß√£o
- Respeitar prefer√™ncias de contato

## üìö Aprendizados

### O que funcionou bem:
- IA cria mensagens mais naturais que templates
- Quebra em 3 partes aumenta engajamento
- Delays humanizados melhoram recep√ß√£o
- Notifica√ß√£o final mant√©m gestora informada
- Filtro duplo evita envios desnecess√°rios

### Desafios:
- Calibrar tom da IA (formal mas n√£o rob√≥tico)
- Definir timing dos delays
- Garantir que API interna est√° sempre online
- Balancear automa√ß√£o com toque humano

### Melhorias futuras:
- Adicionar campo "√∫ltima data de follow-up" para n√£o duplicar
- Escalonar tom baseado em quantas semanas est√° cr√≠tico
- Integrar respostas com sistema de tickets
- Dashboard de taxa de recupera√ß√£o
- Alertas para cr√≠ticos que n√£o respondem

## ü§ù Integra√ß√£o com Processo de CS

### Antes do Workflow:
1. Equipe de projetos monitora clientes
2. Classifica status baseado em crit√©rios
3. Atualiza status na API

### Durante o Workflow:
1. Automa√ß√£o detecta cr√≠ticos
2. Envia mensagem de suporte
3. Cliente recebe acompanhamento

### Depois do Workflow:
1. Cliente responde (ou n√£o)
2. Equipe de CS monitora respostas
3. A√ß√µes manuais conforme necess√°rio
4. Atualiza status ap√≥s resolu√ß√£o

---

## üìÑ Notas Importantes

> üéØ **Customer Success:** Este workflow √© parte de uma estrat√©gia maior de reten√ß√£o.

> ü§ñ **IA + Humano:** Automa√ß√£o faz primeiro contato, mas equipe √© essencial no follow-up.

> ‚ö†Ô∏è **Prioridade:** Clientes cr√≠ticos t√™m alta prioridade - garantir follow-up manual tamb√©m.

> üìä **M√©tricas:** Acompanhar taxa de recupera√ß√£o para medir efetividade.

> üí¨ **Tom:** Mensagens devem ser profissionais mas emp√°ticas - cliente est√° com dificuldade.

---

**Criado em:** 2025  
**√öltima atualiza√ß√£o:** 13/10/2025  
**Status:** ‚úÖ Em produ√ß√£o  
**Frequ√™ncia:** Semanal (Segunda 09:30)  
**Objetivo:** Reduzir churn e aumentar sucesso na implanta√ß√£o
